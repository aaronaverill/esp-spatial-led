<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="stylesheet" href="css/app.css">
</head>
<body class="ma-0" onload="app.init()">
  <div class="d-flex flex-column h-100" class="h-100">
    <!-- This container holds all the page content -->
    <div class="main">
      <!-- The top level library page-->
      <div id="pLibrary" class="d-flex flex-column h-100">
        <div class="title"><div class="img img-vlg img-led ma-2"></div><div class="pa-3">Library</div></div>
        <div class="page">
          <div id="animations" class="list"></div>
        </div>
      </div>
      <!-- The top level settings page -->
      <div id="pSettings" class="d-none flex-column h-100">
        <div class="title"><div class="img img-vlg img-led ma-2"></div><div class="pa-3">Settings</div></div>
        <div class="page">
          <div class="list">
            <div onclick="app.page = 'pLedStrip'" class="item selectable d-flex align-center pa-3"><div class="text mr-3">LED Strip</div><div class="img img-chevron-right flex-shrink-0"></div></div>
            <div onclick="app.page = 'pLedLayout'" class="item selectable d-flex align-center pa-3"><div class="text mr-3">LED Layout</div><div class="img img-chevron-right flex-shrink-0"></div></div>
            <div onclick="app.page = 'pColors'" class="item selectable d-flex align-center pa-3"><div class="text mr-3">Colors</div><div class="img img-chevron-right flex-shrink-0"></div></div>
            <div onclick="app.page = 'pPalettes'" class="item selectable d-flex align-center pa-3"><div class="text mr-3">Palettes</div><div class="img img-chevron-right flex-shrink-0"></div></div>
            <div onclick="app.page = 'pAbout'" class="item selectable d-flex align-center pa-3"><div class="text mr-3">About</div><div class="img img-chevron-right flex-shrink-0"></div></div>
          </div>
        </div>
      </div>
      <!-- Play options modal page -->
      <div id="pPlayOptions" class="d-none flex-column h-100">
        <div class="title">
          <div onclick="app.page = 'pLibrary'" class="btn pa-4"><div class="img img-close"></div></div>
          <div class="pa-3">Options</div>
        </div>
        <div class="page options pa-4">
          <div class="list"></div>
        </div>
      </div>
      <!-- Animation options select color field page -->
      <div id="pAnimationColor" class="d-none flex-column h-100">
        <div class="title">
          <div onclick="app.page = 'pPlayOptions'" class="btn pa-4"><div class="img img-arrow-back"></div></div>
          <div class="text pa-3"></div>
        </div>
        <div class="tabs pa-2 d-flex w-100">
          <div data-tab="palette" onclick="app.setColorActiveTab(this)" class="tab selectable">Palette</div>
          <div data-tab="color" onclick="app.setColorActiveTab(this)" class="tab selectable">Color</div>
        </div>
        <div data-page="palette" class="page palettes d-flex flex-column pa-4">
        </div>
        <div data-page="color" class="page d-flex flex-column pa-4">
          <div class="colors d-flex"></div>
          <div class="list">
            <div class="item py-3">
              <div>Hue</div>
              <div class="d-flex w-100">
                <div class="flex-grow-1 pr-3">
                  <div><input data-type="hsv" data-field="h" type="range" oninput="app.onAnimationColorChange(this)" min="0" max="255" class="w-100" /></div>
                  <div onclick="app.onAnimationHueClick(this, event)" class="rainbow" style="height:20px; margin:0 13px 0 17px"></div>
                </div>
                <div class="value flex-shrink-0 rounded"></div>
              </div>
            </div>
            <div class="item py-3">
              <div>Saturation</div>
              <div class="d-flex w-100">
                <div class="flex-grow-1 pr-3">
                  <div><input data-type="hsv" data-field="s" type="range" oninput="app.onAnimationColorChange(this)" min="0" max="255" class="w-100" /></div>
                  <div class="d-flex justify-between font-micro"><div>0%</div><div>100%</div></div>
                </div>
                <div class="value flex-shrink-0"></div>
              </div>
            </div>
            <div class="item py-3">
              <div>Value</div>
              <div class="d-flex w-100">
                <div class="flex-grow-1 pr-3">
                  <div><input data-type="hsv" data-field="v" type="range" oninput="app.onAnimationColorChange(this)" min="0" max="255" class="w-100" /></div>
                  <div class="d-flex justify-between font-micro"><div>0%</div><div>100%</div></div>
                </div>
                <div class="value flex-shrink-0"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Settings > LED Strip page -->
      <div id="pLedStrip" class="d-none flex-column h-100">
        <div class="title">
          <div onclick="app.page = 'pSettings'" class="btn pa-4"><div class="img img-close"></div></div>
          <div class="pa-3 mr-auto">LED Strip</div>
          <div class="flex-shrink-0 mr-3"><button id="saveLayout" onclick="app.onStripSave()" class="btn tonal primary">Save</button></div>
        </div>
        <div class="page d-flex flex-column pa-4">
          <div>Chipset</div>
          <select id="ledStrip_chipset" class="w-100 my-2"></select>
          <div>Color Order</div>
          <select id="ledStrip_colorOrder" class="w-100 my-2"></select>
        </div>
      </div>
        <!-- Settings > LED Layout page -->
      <div id="pLedLayout" class="d-none flex-column h-100">
        <div class="title">
          <div onclick="app.page = 'pSettings'" class="btn pa-4"><div class="img img-close"></div></div>
          <div class="pa-3 mr-auto">LED Layout</div>
          <div class="flex-shrink-0 mr-3"><button id="saveLayout" onclick="app.onLayoutSave()" class="btn tonal primary">Save</button></div>
        </div>
        <div class="page d-flex flex-column pa-4">
          <div>Layout</div>
          <select id="ledLayoutType" onchange="app.onLayoutTypeChange()" class="w-100 my-2">
            <option value="strip">Strip</option>
            <option value="code">Javascript</option>
          </select>
          <div data-page="strip" class="page-layout">
            <div>Number of LEDs</div>
            <input id="ledCount" type="number" onkeypress="app.onKeyPositiveInt(event)" oninput="app.onLayoutLedCountChange()" class="w-100 my-2" />
          </div>
          <div data-page="code" class="page-layout d-none flex-grow-1 overflow-hidden">
            <div class="d-flex flex-column h-100">
              <div class="d-flex align-center my-2">
                <div class="mr-3">Number of LEDs:</div>
                <div id="codeLeds" class="mr-auto"></div>
                <div class="mr-3">Coordinate Fit:</div>
                <div>
                  <select id="ledFit" onchange="app.onLayoutFitChange()" style="margin-right:1px">
                    <option value="contain">Contain</option>
                    <option value="fill">Fill</option>
                    <option value="none">None</option>
                  </select>
                </div>
              </div>
              <div class="d-flex flex-grow-1 overflow-hidden">
                <textarea id="code" type="text" spellcheck="false" rows="10" 
                  oninput="app.onLayoutCodeChange()" 
                  class="font-small" style="flex-basis:50%; resize:none; margin:1px"
                ></textarea>
                <led-3d id="layoutPreview" class="d-block w-100 h-100 overflow-hidden ml-3" style="flex-basis:50%"></led-3d>
              </div>  
            </div>
          </div>
        </div>
      </div>
      <!-- Settings > Colors page -->
      <div id="pColors" class="d-none flex-column h-100">
        <div class="title">
          <div onclick="app.page = 'pSettings'" class="btn pa-4"><div class="img img-arrow-back"></div></div>
          <div class="pa-3">Colors</div>
        </div>
        <div class="page pa-4">
          <div class="grid"></div>
        </div>
      </div>
      <!-- Settings > Colors > Edit page -->
      <div id="pColorEdit" class="d-none flex-column h-100">
        <div class="title">
          <div onclick="app.page = 'pColors'" class="btn pa-4"><div class="img img-arrow-back"></div></div>
          <div class="text pa-3"></div>
        </div>
        <div class="page pa-4">
          <div class="color w-100" style="height:100px"></div>
          <div class="list">
            <div class="item py-3">
              <div>Hue</div>
              <div class="d-flex w-100">
                <div class="flex-grow-1 pr-3">
                  <div><input data-type="hsv" data-field="h" type="range" oninput="app.onHsvChange(this)" min="0" max="255" class="w-100" /></div>
                  <div onclick="app.onColorHueClick(this, event)" class="rainbow" style="height:20px; margin:0 13px 0 17px"></div>
                </div>
                <div class="value flex-shrink-0 rounded"></div>
              </div>
            </div>
            <div class="item py-3">
              <div>Saturation</div>
              <div class="d-flex w-100">
                <div class="flex-grow-1 pr-3">
                  <div><input data-type="hsv" data-field="s" type="range" oninput="app.onHsvChange(this)" min="0" max="255" class="w-100" /></div>
                  <div class="d-flex justify-between font-micro"><div>0%</div><div>100%</div></div>
                </div>
                <div class="value flex-shrink-0"></div>
              </div>
            </div>
            <div class="item py-3">
              <div>Value</div>
              <div class="d-flex w-100">
                <div class="flex-grow-1 pr-3">
                  <div><input data-type="hsv" data-field="v" type="range" oninput="app.onHsvChange(this)" min="0" max="255" class="w-100" /></div>
                  <div class="d-flex justify-between font-micro"><div>0%</div><div>100%</div></div>
                </div>
                <div class="value flex-shrink-0"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Settings > Palettes page -->
      <div id="pPalettes" class="d-none flex-column h-100">
        <div class="title">
          <div onclick="app.page = 'pSettings'" class="btn pa-4"><div class="img img-arrow-back"></div></div>
          <div class="pa-3">Palettes</div>
          <!-- TODO: Add palette-->
        </div>
        <div class="page pa-4">
        </div>
      </div>
      <!-- Settings > Palettes > Edit page -->
      <div id="pPaletteEdit" class="d-none flex-column h-100">
        <div class="title">
          <div onclick="app.page = 'pPalettes'" class="btn pa-4"><div class="img img-arrow-back"></div></div>
          <div class="text pa-3 mr-auto"></div>
          <div class="btn-delete flex-shrink-0 mr-3"><button onclick="app.onPaleteDelete()" class="btn tonal error">Delete</button></div>
        </div>
        <div class="page d-flex flex-column overflow-hidden">
          <div class="pa-4">
            <div>Name</div>
            <input oninput="app.onPaletteNameChange()" spellcheck="false" class="w-100 my-2" id="paletteName"></input>
            <div id="paletteGradient" onclick="app.onAddStop(event)" class="palette-color color"></div>  
          </div>
          <div class="d-flex flex-column overflow-hidden">
            <div id="stopName" class="title mb-2" style="border-bottom:1px solid #FFF6">
              <div class="text flex-grow-1 text-center pa-3">Colors</div>
              <div data-stop onclick="app.onEditStop(undefined)" class="btn pa-4"><div class="img img-arrow-back"></div></div>
              <div data-stop class="text stop-color flex-grow-1 my-2"><div style="padding:4px 0">&nbsp;</div></div>
              <div data-stop class="btn pa-4"><div class="img"></div></div>
            </div>
            <div id="stops" class="list overflow-y-auto"></div>
            <div id="stop" data-stop class="list overflow-y-auto px-4">
              <div class="item py-3">
                <div>Position</div>
                <div class="d-flex w-100">
                  <div class="flex-grow-1 pr-3">
                    <div><input data-field="percent" type="range" oninput="app.onStopPercentChange(this)" min="0" max="255" class="w-100" /></div>
                    <div class="d-flex justify-between font-micro"><div>0</div><div>255</div></div>
                  </div>
                  <div class="value flex-shrink-0"></div>
                </div>
              </div>
              <div class="item py-3">
                <div>Hue</div>
                <div class="d-flex w-100">
                  <div class="flex-grow-1 pr-3">
                    <div><input data-type="hsv" data-field="h" type="range" oninput="app.onStopHsvChange(this)" min="0" max="255" class="w-100" /></div>
                    <div onclick="app.onStopHueClick(this, event)" class="rainbow" style="height:20px; margin:0 13px 0 17px"></div>
                  </div>
                  <div class="value flex-shrink-0 rounded"></div>
                </div>
              </div>
              <div class="item py-3">
                <div>Saturation</div>
                <div class="d-flex w-100">
                  <div class="flex-grow-1 pr-3">
                    <div><input data-type="hsv" data-field="s" type="range" oninput="app.onStopHsvChange(this)" min="0" max="255" class="w-100" /></div>
                    <div class="d-flex justify-between font-micro"><div>0%</div><div>100%</div></div>
                  </div>
                  <div class="value flex-shrink-0"></div>
                </div>
              </div>
              <div class="item py-3">
                <div>Value</div>
                <div class="d-flex w-100">
                  <div class="flex-grow-1 pr-3">
                    <div><input data-type="hsv" data-field="v" type="range" oninput="app.onStopHsvChange(this)" min="0" max="255" class="w-100" /></div>
                    <div class="d-flex justify-between font-micro"><div>0%</div><div>100%</div></div>
                  </div>
                  <div class="value flex-shrink-0"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Settings > About page -->
      <div id="pAbout" class="d-none flex-column h-100">
        <div class="title">
          <div onclick="app.page = 'pSettings'" class="btn pa-4"><div class="img img-arrow-back"></div></div>
          <div class="pa-3">About</div>
        </div>
        <div class="page pa-4"></div>
      </div>
    </div>
    <!-- Current animation playback -->
    <div class="play">
      <div class="d-flex w-100">
        <div id="play-name" class="text-truncate pa-3 mr-auto">&nbsp;</div>
        <div onclick="app.page = 'pPlayOptions'" class="btn pa-3"><div class="img img-options"></div></div>
      </div>
      <img id="playPreview" class="w-100" style="height:10px" />
    </div>
    <!-- Primary navigation -->
    <div class="nav d-flex w-100">
      <div data-page="pLibrary" onclick="app.page = this.dataset.page" class="selectable selected"><div class="img img-lg img-library mb-2"></div><div>Library</div></div>
      <div data-page="pSettings" onclick="app.page = this.dataset.page" class="selectable"><div class="img img-lg img-gear mb-2"></div><div>Settings</div></div>
    </div>
  </div>

  <!-- Templates are processed with eval() for variable expansion. A very basic template processor that keeps code small. -->
  <!-- Inner text of script elements are not compressed by the HTML minifier so don't go too crazy here. -->
  <!-- This could be futher storage optimized by removing whitespace but we are opting for easier maintainance by keeping the formatting. -->
  <!-- Gzip will compress most of this -->

  <!-- Template for option controls for field type 'slider' -->
  <script type="text/x-template" id="t_slider">
<div data-field="${id}" class="item pa-2">
  <div>${label}</div>
  <div class="d-flex w-100">
    <div class="flex-grow-1 pr-3">
      <div><input type="range" oninput="app.onOptionChange(this)" min="${range[0]}" max="${range[1]}" class="w-100" /></div>
      <div class="d-flex justify-between font-micro"><div>${rangeLabels[0]}</div><div>${rangeLabels[1]}</div></div>
    </div>
    <div class="value flex-shrink-0"></div>
  </div>
</div>
  </script>

  <!-- Template for option controls for field type 'hue' -->
  <script type="text/x-template" id="t_hue">
<div data-field="${id}" class="item pa-2">
  <div>${label}</div>
  <div class="d-flex w-100">
    <div class="flex-grow-1 pr-3">
      <div><input type="range" oninput="app.onOptionChange(this)" min="0" max="255" class="w-100" /></div>
      <div class="rainbow" style="height:10px; margin:0 5px 0 9px"></div>
    </div>
    <div class="value flex-shrink-0 rounded"></div>
  </div>
</div>
  </script>

  <!-- Template for option controls for field type 'color' and 'palette' -->
  <script type="text/x-template" id="t_color">
<div data-field="${id}" class="item pa-2">
  <div>${label}</div>
  <div class="color-controls d-flex w-100">
    <div class="solid-color flex-grow-1 pr-3">
      <div><input type="range" oninput="app.onOptionColorHueChange(this)" min="0" max="255" class="w-100" /></div>
      <div class="rainbow" style="height:10px; margin:0 5px 0 9px"></div>
    </div>
    <div onclick="app.onSelectAnimationColor(this)" class="solid-color value color flex-shrink-0 selectable"><div class="number"></div></div>
    <div data-palette onclick="app.onSelectAnimationColor(this)" class="palette-color color selectable flex-grow-1"><div class="name"></div></div>
  </div>
</div>
  </script>

  <script type="module">
    import App from '/js/app.js'
    window.app = new App()
  </script>
</body>
</html>